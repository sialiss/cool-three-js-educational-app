import{_ as $,F as j,c as l,o as a,a as n,t as h,G as u,K as x,L as I,E,M as C,r as w,h as B,s as M,N as R,O as S,P as T,Q as D,R as b}from"./Ds8at5K-.js";const N={class:"lesson-detail pad-l"},O={class:"button-group"},P={__name:"LessonDescription",props:{lesson:Object},setup(c){const{getRole:y,toggleComplete:f}=j(),m=E(),r=C("lessons"),i=C("selectedLesson"),v=t=>{m.push(`/lesson/${t}`)},g=t=>{m.push(`/practice/${t}`)},o=async t=>{try{const e=f(t),d=r.value.find(s=>s.id===t);d&&(d.completed=!d.completed),d.completed&&(i.value=r.value.find(s=>!s.completed)||i.value)}catch(e){console.error("Ошибка при обновлении статуса урока:",e)}};return(t,e)=>(a(),l("div",N,[n("h2",null,h(c.lesson.title),1),n("p",null,h(c.lesson.description),1),n("div",O,[c.lesson.theory?(a(),l("button",{key:0,onClick:e[0]||(e[0]=d=>v(c.lesson.theory.id)),class:"primary"},"Открыть теорию")):u("",!0),c.lesson.practice?(a(),l("button",{key:1,onClick:e[1]||(e[1]=d=>g(c.lesson.practice.id)),class:"secondary"},"Открыть практику")):u("",!0),x(y)()=="user"?(a(),l("button",{key:2,onClick:e[2]||(e[2]=d=>o(c.lesson.id)),class:I(c.lesson.completed?"completed completed-active":"completed")}," ✔ "+h(c.lesson.completed?"Пройдено":"Отметить пройденным"),3)):u("",!0)])]))}},U=$(P,[["__scopeId","data-v-4f56a5c0"]]),z={class:"dashboard"},F={key:0},V={class:"progress-bar"},A={class:"progress-text"},G={class:"lessons"},K={class:"item-list lesson-list"},Q=["onClick"],q={key:0,class:"status"},H={key:1,class:"status"},J={key:2,class:"status"},W={__name:"dashboard",setup(c){const{getRole:y,getMe:f,isOffline:m}=j(),r=w([]),i=w(null);B(async()=>{try{let o,t;if(console.log(m.value),m.value)o=await(await fetch("data/lessons.json")).json(),t=(await(await fetch("data/users.json")).json())[0];else{const s=await fetch("http://localhost:8000/lessons/",{headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("Не удалось загрузить уроки");o=await s.json();const p=await f();if(!p.ok)throw new Error("Не удалось загрузить пользователя");t=p.user}const e=new Set(t.completedTheoryLessons.map(s=>s.id)),d=new Set(t.completedPracticeLessons.map(s=>s.id));o.forEach(s=>{var _,L;const p=(_=s.theory)==null?void 0:_.id,k=(L=s.practice)==null?void 0:L.id;s.theoryCompleted=p?e.has(p):!0,s.practiceCompleted=k?d.has(k):!0,s.completed=s.theoryCompleted&&s.practiceCompleted}),r.value=o,i.value=r.value.find(s=>!s.completed)||r.value[0]}catch(o){console.error("Ошибка загрузки данных:",o)}}),b("lessons",r),b("selectedLesson",i);const v=M(()=>{const o=r.value.filter(t=>t.completed).length;return Math.round(o/r.value.length*100)}),g=o=>{i.value=o};return(o,t)=>(a(),l("div",z,[x(y)()=="user"?(a(),l("div",F,[t[0]||(t[0]=n("h2",{class:"text-center pad-top-m"},"Прогресс обучения",-1)),n("div",V,[n("div",{class:"progress",style:R({width:v.value+"%"})},null,4)]),n("p",A,h(v.value)+"% завершено",1)])):u("",!0),t[1]||(t[1]=n("h2",{class:"text-center pad-top-m"},"Список уроков",-1)),n("div",G,[n("ul",K,[(a(!0),l(T,null,D(r.value,e=>(a(),l("li",{key:e.id,onClick:d=>g(e),class:I({completed:e.completed,selected:e===i.value})},[n("span",null,h(e.title),1),n("div",null,[e.practice&&e.practiceCompleted?(a(),l("span",q,"🚘︎")):u("",!0),e.theory&&e.theoryCompleted?(a(),l("span",H,"🕮")):u("",!0),e.completed?(a(),l("span",J,"✓")):u("",!0)])],10,Q))),128))]),i.value?(a(),S(U,{key:0,lesson:i.value},null,8,["lesson"])):u("",!0)])]))}},Y=$(W,[["__scopeId","data-v-b72da6fb"]]);export{Y as default};
