import{_ as O,r as g,S as x,T as G,h as q,c as r,o as a,a as e,d as m,t as i,I as u,J as d,U as w,P as k,Q as C,H as N,O as P,G as D,L as B}from"./B1qYCYvZ.js";const L={class:"details"},M={key:0},J={key:0},R={key:1},z={key:1},A=["value"],F={__name:"UserDetails",props:{user:Object},emits:["refresh"],setup(E,{emit:$}){const v=E,b=$,f=g(!1),n=x({...v.user,groups:v.user.groups||[]}),p=g(""),I=g([]),s=g([]);G(()=>v.user,t=>{var l;Object.assign(n,t,{groups:t.groups||[]}),s.value=((l=t.groups)==null?void 0:l.map(V=>V.id))||[],f.value=!1}),q(async()=>{await U(),v.user.groups&&(s.value=v.user.groups.map(t=>t.id))});const U=async()=>{const l=await(await fetch("http://localhost:8000/group")).json();I.value=l},S=()=>{f.value=!0},j=()=>{var t;Object.assign(n,v.user),s.value=((t=v.user.groups)==null?void 0:t.map(l=>l.id))||[],p.value="",f.value=!1},T=async()=>{const t={name:n.name,surname:n.surname,patronymic:n.patronymic,login:n.login,email:n.email,phone:n.phone,role:n.role,groupIds:s.value};p.value&&(t.password=p.value),await fetch(`http://localhost:8000/user/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),f.value=!1,p.value="",b("refresh")},y=async()=>{confirm("Удалить пользователя?")&&(await fetch(`http://localhost:8000/user/${n.id}`,{method:"DELETE"}),b("refresh"))};return(t,l)=>{var V;return a(),r("div",L,[l[32]||(l[32]=e("h3",{class:"subtitle"},"Информация о пользователе",-1)),f.value?(a(),r("div",z,[e("p",null,[l[16]||(l[16]=e("strong",null,"Имя:",-1)),l[17]||(l[17]=m()),u(e("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>n.name=o)},null,512),[[d,n.name]])]),e("p",null,[l[18]||(l[18]=e("strong",null,"Фамилия:",-1)),l[19]||(l[19]=m()),u(e("input",{"onUpdate:modelValue":l[1]||(l[1]=o=>n.surname=o)},null,512),[[d,n.surname]])]),e("p",null,[l[20]||(l[20]=e("strong",null,"Отчество:",-1)),l[21]||(l[21]=m()),u(e("input",{"onUpdate:modelValue":l[2]||(l[2]=o=>n.patronymic=o)},null,512),[[d,n.patronymic]])]),e("p",null,[l[22]||(l[22]=e("strong",null,"Телефон:",-1)),l[23]||(l[23]=m()),u(e("input",{"onUpdate:modelValue":l[3]||(l[3]=o=>n.phone=o)},null,512),[[d,n.phone]])]),e("p",null,[l[24]||(l[24]=e("strong",null,"Email:",-1)),l[25]||(l[25]=m()),u(e("input",{"onUpdate:modelValue":l[4]||(l[4]=o=>n.email=o)},null,512),[[d,n.email]])]),e("p",null,[l[26]||(l[26]=e("strong",null,"Логин:",-1)),l[27]||(l[27]=m()),u(e("input",{"onUpdate:modelValue":l[5]||(l[5]=o=>n.login=o)},null,512),[[d,n.login]])]),e("p",null,[l[28]||(l[28]=e("strong",null,"Пароль:",-1)),u(e("input",{"onUpdate:modelValue":l[6]||(l[6]=o=>p.value=o),type:"password",placeholder:"(оставьте пустым, если не меняется)"},null,512),[[d,p.value]])]),e("p",null,[l[30]||(l[30]=e("strong",null,"Роль:",-1)),u(e("select",{"onUpdate:modelValue":l[7]||(l[7]=o=>n.role=o)},l[29]||(l[29]=[e("option",{value:"user"},"user",-1),e("option",{value:"admin"},"admin",-1),e("option",{value:"moderator"},"moderator",-1)]),512),[[w,n.role]])]),e("p",null,[l[31]||(l[31]=e("strong",null,"Группы:",-1)),u(e("select",{"onUpdate:modelValue":l[8]||(l[8]=o=>s.value=o),multiple:""},[(a(!0),r(k,null,C(I.value,o=>(a(),r("option",{key:o.id,value:o.id},i(o.name),9,A))),128))],512),[[w,s.value]])]),e("div",{class:"buttons"},[e("button",{onClick:T,class:"save-btn"},"Сохранить"),e("button",{onClick:j,class:"cancel-btn"},"Отмена")])])):(a(),r("div",M,[e("p",null,[l[9]||(l[9]=e("strong",null,"ID:",-1)),m(" "+i(E.user.id),1)]),e("p",null,[l[10]||(l[10]=e("strong",null,"ФИО:",-1)),m(" "+i(n.surname+" "+n.name+" "+n.patronymic),1)]),e("p",null,[l[11]||(l[11]=e("strong",null,"Группы: ",-1)),((V=n.groups)==null?void 0:V.length)>0?(a(),r("span",J,i(n.groups.map(o=>o.name).join(", ")),1)):(a(),r("span",R,"—"))]),e("p",null,[l[12]||(l[12]=e("strong",null,"Телефон:",-1)),m(" "+i(n.phone),1)]),e("p",null,[l[13]||(l[13]=e("strong",null,"Email:",-1)),m(" "+i(n.email),1)]),e("p",null,[l[14]||(l[14]=e("strong",null,"Логин:",-1)),m(" "+i(n.login),1)]),e("p",null,[l[15]||(l[15]=e("strong",null,"Роль:",-1)),m(" "+i(n.role),1)]),e("div",{class:"buttons"},[e("button",{onClick:S,class:"edit-btn"},"Изменить"),e("button",{onClick:y,class:"delete-btn"},"Удалить")])]))])}}},H=O(F,[["__scopeId","data-v-6a7bf91b"]]),Q={class:"dashboard"},K={class:"top-controls"},W={class:"filters"},X=["value"],Y={class:"users"},Z={key:0,class:"create-user-form"},h=["value"],c=["value"],_={class:"item-list user-list"},ll=["onClick"],el={key:0,class:"status"},tl={__name:"adminpanel",setup(E){const $=g([]),v=g([]),b=g(""),f=g(""),n=g(null),p=g(!1),I=["user","admin","moderator"],s=g({surname:"",name:"",patronymic:"",email:"",login:"",password:"",phone:"",role:"user",groupIds:[]}),U=async()=>{const y=new URLSearchParams;b.value&&y.append("groupId",b.value),f.value&&y.append("status",f.value);const t=await fetch(`http://localhost:8000/user?${y.toString()}`);$.value=await t.json(),n.value=null},S=async()=>{const y=await fetch("http://localhost:8000/group");v.value=await y.json()};q(()=>{S(),U()});const j=y=>{n.value=y},T=async()=>{await fetch("http://localhost:8000/user/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s.value)}),await U(),p.value=!1,s.value={surname:"",name:"",patronymic:"",email:"",login:"",password:"",phone:"",role:"user",groupIds:[]}};return(y,t)=>(a(),r("div",Q,[e("div",K,[t[14]||(t[14]=e("h2",null,"Список пользователей",-1)),e("div",W,[u(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>b.value=l),onChange:U,class:"filter-select"},[t[12]||(t[12]=e("option",{value:""},"Все группы",-1)),(a(!0),r(k,null,C(v.value,l=>(a(),r("option",{key:l.id,value:l.id},i(l.name),9,X))),128))],544),[[w,b.value]]),u(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>f.value=l),onChange:U,class:"filter-select"},t[13]||(t[13]=[e("option",{value:""},"Все статусы",-1),e("option",{value:"active"},"Активные",-1),e("option",{value:"finished"},"Завершённые",-1)]),544),[[w,f.value]])]),e("button",{class:"create-btn",onClick:t[2]||(t[2]=l=>p.value=!p.value)},i(p.value?"Отмена":"Создать пользователя"),1)]),e("div",Y,[p.value?(a(),r("div",Z,[e("form",{onSubmit:N(T,["prevent"])},[u(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.surname=l),placeholder:"Фамилия",required:""},null,512),[[d,s.value.surname]]),u(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.name=l),placeholder:"Имя",required:""},null,512),[[d,s.value.name]]),u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>s.value.patronymic=l),placeholder:"Отчество"},null,512),[[d,s.value.patronymic]]),u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>s.value.email=l),placeholder:"Email",required:""},null,512),[[d,s.value.email]]),u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>s.value.login=l),placeholder:"Логин",required:""},null,512),[[d,s.value.login]]),u(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>s.value.password=l),placeholder:"Пароль",type:"password",required:""},null,512),[[d,s.value.password]]),u(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>s.value.phone=l),placeholder:"Телефон"},null,512),[[d,s.value.phone]]),u(e("select",{"onUpdate:modelValue":t[10]||(t[10]=l=>s.value.role=l),required:""},[(a(),r(k,null,C(I,l=>e("option",{key:l,value:l},i(l.charAt(0).toUpperCase()+l.slice(1)),9,h)),64))],512),[[w,s.value.role]]),t[15]||(t[15]=e("label",null,"Группы:",-1)),u(e("select",{"onUpdate:modelValue":t[11]||(t[11]=l=>s.value.groupIds=l),multiple:""},[(a(!0),r(k,null,C(v.value,l=>(a(),r("option",{key:l.id,value:l.id},i(l.name),9,c))),128))],512),[[w,s.value.groupIds]]),t[16]||(t[16]=e("button",{type:"submit",class:"submit-btn"},"Сохранить",-1))],32)])):(a(),r(k,{key:1},[e("ul",_,[(a(!0),r(k,null,C($.value,l=>(a(),r("li",{key:l.id,onClick:V=>j(l),class:B({admin:l.role==="admin",selected:l===n.value})},[e("span",null,i(l.surname)+" "+i(l.name)+" ("+i(l.login)+")",1),l.role==="admin"?(a(),r("span",el,"👑")):D("",!0)],10,ll))),128))]),n.value?(a(),P(H,{key:0,user:n.value,onRefresh:U},null,8,["user"])):D("",!0)],64))])]))}},sl=O(tl,[["__scopeId","data-v-2b926ad0"]]);export{sl as default};
