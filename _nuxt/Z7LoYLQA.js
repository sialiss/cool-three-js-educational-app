import{_ as N,r as y,S as z,T as H,h as P,c as i,o as r,a as l,d as g,t as p,I as u,J as d,U as C,P as V,Q as D,F as Q,H as K,O as W,G,L as X}from"./BT96c_Lw.js";const Y={class:"details"},Z={key:0},c={key:0},h={key:1},_={key:1},ee=["value"],le={__name:"UserDetails",props:{user:Object},emits:["refresh"],setup($,{emit:I}){const f=$,k=I,m=y(!1),s=z({...f.user,groups:f.user.groups||[]}),v=y(""),w=y([]),b=y([]);H(()=>f.user,o=>{var e;Object.assign(s,o,{groups:o.groups||[]}),b.value=((e=o.groups)==null?void 0:e.map(t=>t.id))||[],m.value=!1}),P(async()=>{await a(),f.user.groups&&(b.value=f.user.groups.map(o=>o.id))});const a=async()=>{const e=await(await fetch("http://localhost:8000/group")).json();w.value=e},U=()=>{m.value=!0},E=()=>{var o;Object.assign(s,f.user),b.value=((o=f.user.groups)==null?void 0:o.map(e=>e.id))||[],v.value="",m.value=!1},S=async()=>{const o={name:s.name,surname:s.surname,patronymic:s.patronymic,login:s.login,email:s.email,phone:s.phone,role:s.role,groupIds:b.value};v.value&&(o.password=v.value),await fetch(`http://localhost:8000/user/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),m.value=!1,v.value="",k("refresh")},O=async()=>{confirm("Удалить пользователя?")&&(await fetch(`http://localhost:8000/user/${s.id}`,{method:"DELETE"}),k("refresh"))};return(o,e)=>{var t;return r(),i("div",Y,[e[32]||(e[32]=l("h3",{class:"subtitle"},"Информация о пользователе",-1)),m.value?(r(),i("div",_,[l("p",null,[e[16]||(e[16]=l("strong",null,"Имя:",-1)),e[17]||(e[17]=g()),u(l("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>s.name=n)},null,512),[[d,s.name]])]),l("p",null,[e[18]||(e[18]=l("strong",null,"Фамилия:",-1)),e[19]||(e[19]=g()),u(l("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>s.surname=n)},null,512),[[d,s.surname]])]),l("p",null,[e[20]||(e[20]=l("strong",null,"Отчество:",-1)),e[21]||(e[21]=g()),u(l("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>s.patronymic=n)},null,512),[[d,s.patronymic]])]),l("p",null,[e[22]||(e[22]=l("strong",null,"Телефон:",-1)),e[23]||(e[23]=g()),u(l("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>s.phone=n)},null,512),[[d,s.phone]])]),l("p",null,[e[24]||(e[24]=l("strong",null,"Email:",-1)),e[25]||(e[25]=g()),u(l("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>s.email=n)},null,512),[[d,s.email]])]),l("p",null,[e[26]||(e[26]=l("strong",null,"Логин:",-1)),e[27]||(e[27]=g()),u(l("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>s.login=n)},null,512),[[d,s.login]])]),l("p",null,[e[28]||(e[28]=l("strong",null,"Пароль:",-1)),u(l("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>v.value=n),type:"password",placeholder:"(оставьте пустым, если не меняется)"},null,512),[[d,v.value]])]),l("p",null,[e[30]||(e[30]=l("strong",null,"Роль:",-1)),u(l("select",{"onUpdate:modelValue":e[7]||(e[7]=n=>s.role=n)},e[29]||(e[29]=[l("option",{value:"user"},"user",-1),l("option",{value:"admin"},"admin",-1),l("option",{value:"moderator"},"moderator",-1)]),512),[[C,s.role]])]),l("p",null,[e[31]||(e[31]=l("strong",null,"Группы:",-1)),u(l("select",{"onUpdate:modelValue":e[8]||(e[8]=n=>b.value=n),multiple:""},[(r(!0),i(V,null,D(w.value,n=>(r(),i("option",{key:n.id,value:n.id},p(n.name),9,ee))),128))],512),[[C,b.value]])]),l("div",{class:"buttons"},[l("button",{onClick:S,class:"save-btn"},"Сохранить"),l("button",{onClick:E,class:"cancel-btn"},"Отмена")])])):(r(),i("div",Z,[l("p",null,[e[9]||(e[9]=l("strong",null,"ID:",-1)),g(" "+p($.user.id),1)]),l("p",null,[e[10]||(e[10]=l("strong",null,"ФИО:",-1)),g(" "+p(s.surname+" "+s.name+" "+s.patronymic),1)]),l("p",null,[e[11]||(e[11]=l("strong",null,"Группы: ",-1)),((t=s.groups)==null?void 0:t.length)>0?(r(),i("span",c,p(s.groups.map(n=>n.name).join(", ")),1)):(r(),i("span",h,"—"))]),l("p",null,[e[12]||(e[12]=l("strong",null,"Телефон:",-1)),g(" "+p(s.phone),1)]),l("p",null,[e[13]||(e[13]=l("strong",null,"Email:",-1)),g(" "+p(s.email),1)]),l("p",null,[e[14]||(e[14]=l("strong",null,"Логин:",-1)),g(" "+p(s.login),1)]),l("p",null,[e[15]||(e[15]=l("strong",null,"Роль:",-1)),g(" "+p(s.role),1)]),l("div",{class:"buttons"},[l("button",{onClick:U,class:"edit-btn"},"Изменить"),l("button",{onClick:O,class:"delete-btn"},"Удалить")])]))])}}},te=N(le,[["__scopeId","data-v-6a7bf91b"]]),se={class:"dashboard"},ne={class:"top-controls"},oe={class:"filters"},ae=["value"],ue={class:"users"},re={key:0,class:"create-user-form"},ie=["value"],pe=["value"],de={class:"item-list user-list"},me=["onClick"],ve={key:0,class:"status"},ge={__name:"adminpanel",setup($){const{isOffline:I}=Q(),f=y([]),k=y([]),m=y(""),s=y(""),v=y(null),w=y(!1),b=["user","admin","moderator"],a=y({surname:"",name:"",patronymic:"",email:"",login:"",password:"",phone:"",role:"user",groupIds:[]}),U=async()=>{const o=new URLSearchParams;m.value&&o.append("groupId",m.value),s.value&&o.append("status",s.value);try{let e,t;if(I.value){const[n,B]=await Promise.all([fetch("data/users.json"),fetch("data/groups.json")]);e=await n.json(),t=await B.json();const L=new Date,M=m.value?Number(m.value):null,R=new Map(t.map(j=>[j.id,j]));f.value=e.filter(j=>{var x;const A=M==null||(j.groups||[]).includes(M),q=(x=j.groups)==null?void 0:x.some(F=>{const T=R.get(F);return!T||!T.endDate?!1:new Date(T.endDate)>L}),J=!s.value||s.value==="active"&&q||s.value==="finished"&&!q;return A&&J})}else{const n=await fetch(`http://localhost:8000/user?${o.toString()}`);f.value=await n.json()}v.value=null}catch(e){console.error("Ошибка загрузки пользователей:",e)}},E=async()=>{try{let o;I.value?o=await fetch("data/groups.json"):o=await fetch("http://localhost:8000/group"),k.value=await o.json()}catch(o){console.error("Ошибка загрузки групп:",o)}};P(()=>{E(),U()});const S=o=>{v.value=o},O=async()=>{await fetch("http://localhost:8000/user/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a.value)}),await U(),w.value=!1,a.value={surname:"",name:"",patronymic:"",email:"",login:"",password:"",phone:"",role:"user",groupIds:[]}};return(o,e)=>(r(),i("div",se,[l("div",ne,[e[14]||(e[14]=l("h2",null,"Список пользователей",-1)),l("div",oe,[u(l("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),onChange:U,class:"filter-select"},[e[12]||(e[12]=l("option",{value:""},"Все группы",-1)),(r(!0),i(V,null,D(k.value,t=>(r(),i("option",{key:t.id,value:t.id},p(t.name),9,ae))),128))],544),[[C,m.value]]),u(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.value=t),onChange:U,class:"filter-select"},e[13]||(e[13]=[l("option",{value:""},"Все статусы",-1),l("option",{value:"active"},"Активные",-1),l("option",{value:"finished"},"Завершённые",-1)]),544),[[C,s.value]])]),l("button",{class:"create-btn",onClick:e[2]||(e[2]=t=>w.value=!w.value)},p(w.value?"Отмена":"Создать пользователя"),1)]),l("div",ue,[w.value?(r(),i("div",re,[l("form",{onSubmit:K(O,["prevent"])},[u(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.surname=t),placeholder:"Фамилия",required:""},null,512),[[d,a.value.surname]]),u(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.name=t),placeholder:"Имя",required:""},null,512),[[d,a.value.name]]),u(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.patronymic=t),placeholder:"Отчество"},null,512),[[d,a.value.patronymic]]),u(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.email=t),placeholder:"Email",required:""},null,512),[[d,a.value.email]]),u(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.login=t),placeholder:"Логин",required:""},null,512),[[d,a.value.login]]),u(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.password=t),placeholder:"Пароль",type:"password",required:""},null,512),[[d,a.value.password]]),u(l("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.phone=t),placeholder:"Телефон"},null,512),[[d,a.value.phone]]),u(l("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>a.value.role=t),required:""},[(r(),i(V,null,D(b,t=>l("option",{key:t,value:t},p(t.charAt(0).toUpperCase()+t.slice(1)),9,ie)),64))],512),[[C,a.value.role]]),e[15]||(e[15]=l("label",null,"Группы:",-1)),u(l("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.groupIds=t),multiple:""},[(r(!0),i(V,null,D(k.value,t=>(r(),i("option",{key:t.id,value:t.id},p(t.name),9,pe))),128))],512),[[C,a.value.groupIds]]),e[16]||(e[16]=l("button",{type:"submit",class:"submit-btn"},"Сохранить",-1))],32)])):(r(),i(V,{key:1},[l("ul",de,[(r(!0),i(V,null,D(f.value,t=>(r(),i("li",{key:t.id,onClick:n=>S(t),class:X({admin:t.role==="admin",selected:t===v.value})},[l("span",null,p(t.surname)+" "+p(t.name)+" ("+p(t.login)+")",1),t.role==="admin"?(r(),i("span",ve,"👑")):G("",!0)],10,me))),128))]),v.value?(r(),W(te,{key:0,user:v.value,onRefresh:U},null,8,["user"])):G("",!0)],64))])]))}},ye=N(ge,[["__scopeId","data-v-9fafe882"]]);export{ye as default};
