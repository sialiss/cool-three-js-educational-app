import{_ as G,r as y,S as H,T as Q,h as N,c as r,o as u,a as l,d as g,t as p,I as a,J as m,U as C,P as V,Q as j,F as K,H as W,O as X,G as x,y as Y,L as Z}from"./gRhvr9zX.js";const c={class:"details"},h={key:0},_={key:0},ee={key:1},le={key:1},te=["value"],se={__name:"UserDetails",props:{user:Object},emits:["refresh"],setup(E,{emit:D}){const f=E,k=D,b=y(!1),n=H({...f.user,groups:f.user.groups||[]}),d=y(""),U=y([]),v=y([]);Q(()=>f.user,i=>{var e;Object.assign(n,i,{groups:i.groups||[]}),v.value=((e=i.groups)==null?void 0:e.map(s=>s.id))||[],b.value=!1}),N(async()=>{await S(),f.user.groups&&(v.value=f.user.groups.map(i=>i.id))});const S=async()=>{const e=await(await fetch("http://localhost:8000/group")).json();U.value=e},o=()=>{b.value=!0},w=()=>{var i;Object.assign(n,f.user),v.value=((i=f.user.groups)==null?void 0:i.map(e=>e.id))||[],d.value="",b.value=!1},O=async()=>{const i={name:n.name,surname:n.surname,patronymic:n.patronymic,login:n.login,email:n.email,phone:n.phone,role:n.role,groupIds:v.value};d.value&&(i.password=d.value),await fetch(`http://localhost:8000/user/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),b.value=!1,d.value="",k("refresh")},R=async()=>{confirm("Удалить пользователя?")&&(await fetch(`http://localhost:8000/user/${n.id}`,{method:"DELETE"}),k("refresh"))};return(i,e)=>{var s;return u(),r("div",c,[e[32]||(e[32]=l("h3",{class:"subtitle"},"Информация о пользователе",-1)),b.value?(u(),r("div",le,[l("p",null,[e[16]||(e[16]=l("strong",null,"Имя:",-1)),e[17]||(e[17]=g()),a(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>n.name=t)},null,512),[[m,n.name]])]),l("p",null,[e[18]||(e[18]=l("strong",null,"Фамилия:",-1)),e[19]||(e[19]=g()),a(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>n.surname=t)},null,512),[[m,n.surname]])]),l("p",null,[e[20]||(e[20]=l("strong",null,"Отчество:",-1)),e[21]||(e[21]=g()),a(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>n.patronymic=t)},null,512),[[m,n.patronymic]])]),l("p",null,[e[22]||(e[22]=l("strong",null,"Телефон:",-1)),e[23]||(e[23]=g()),a(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>n.phone=t)},null,512),[[m,n.phone]])]),l("p",null,[e[24]||(e[24]=l("strong",null,"Email:",-1)),e[25]||(e[25]=g()),a(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>n.email=t)},null,512),[[m,n.email]])]),l("p",null,[e[26]||(e[26]=l("strong",null,"Логин:",-1)),e[27]||(e[27]=g()),a(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>n.login=t)},null,512),[[m,n.login]])]),l("p",null,[e[28]||(e[28]=l("strong",null,"Пароль:",-1)),a(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>d.value=t),type:"password",placeholder:"(оставьте пустым, если не меняется)"},null,512),[[m,d.value]])]),l("p",null,[e[30]||(e[30]=l("strong",null,"Роль:",-1)),a(l("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>n.role=t)},e[29]||(e[29]=[l("option",{value:"user"},"user",-1),l("option",{value:"admin"},"admin",-1),l("option",{value:"moderator"},"moderator",-1)]),512),[[C,n.role]])]),l("p",null,[e[31]||(e[31]=l("strong",null,"Группы:",-1)),a(l("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>v.value=t),multiple:""},[(u(!0),r(V,null,j(U.value,t=>(u(),r("option",{key:t.id,value:t.id},p(t.name),9,te))),128))],512),[[C,v.value]])]),l("div",{class:"buttons"},[l("button",{onClick:O,class:"save-btn"},"Сохранить"),l("button",{onClick:w,class:"cancel-btn"},"Отмена")])])):(u(),r("div",h,[l("p",null,[e[9]||(e[9]=l("strong",null,"ID:",-1)),g(" "+p(E.user.id),1)]),l("p",null,[e[10]||(e[10]=l("strong",null,"ФИО:",-1)),g(" "+p(n.surname+" "+n.name+" "+n.patronymic),1)]),l("p",null,[e[11]||(e[11]=l("strong",null,"Группы: ",-1)),((s=n.groups)==null?void 0:s.length)>0?(u(),r("span",_,p(n.groups.map(t=>t.name).join(", ")),1)):(u(),r("span",ee,"—"))]),l("p",null,[e[12]||(e[12]=l("strong",null,"Телефон:",-1)),g(" "+p(n.phone),1)]),l("p",null,[e[13]||(e[13]=l("strong",null,"Email:",-1)),g(" "+p(n.email),1)]),l("p",null,[e[14]||(e[14]=l("strong",null,"Логин:",-1)),g(" "+p(n.login),1)]),l("p",null,[e[15]||(e[15]=l("strong",null,"Роль:",-1)),g(" "+p(n.role),1)]),l("div",{class:"buttons"},[l("button",{onClick:o,class:"edit-btn"},"Изменить"),l("button",{onClick:R,class:"delete-btn"},"Удалить")])]))])}}},ne=G(se,[["__scopeId","data-v-6a7bf91b"]]),oe={class:"dashboard"},ae={class:"top-controls"},ue={class:"filters"},re=["value"],ie={class:"users"},pe={key:0,class:"create-user-form"},de=["value"],me=["value"],ve={class:"item-list user-list"},ge=["onClick"],fe={key:0,class:"status"},ye={__name:"adminpanel",setup(E){const{isOffline:D}=K(),f=Y(),k=y([]),b=y([]),n=y(""),d=y(""),U=y(null),v=y(!1),S=["user","admin","moderator"],o=y({surname:"",name:"",patronymic:"",email:"",login:"",password:"",phone:"",role:"user",groupIds:[]}),w=async()=>{const e=new URLSearchParams;n.value&&e.append("groupId",n.value),d.value&&e.append("status",d.value);try{let s,t;if(D.value){const[I,P]=await Promise.all([fetch(`${f.app.baseURL}data/users.json`),fetch(`${f.app.baseURL}data/groups.json`)]);s=await I.json(),t=await P.json();const B=new Date,L=n.value?Number(n.value):null,A=new Map(t.map($=>[$.id,$]));k.value=s.filter($=>{var q;const J=L==null||($.groups||[]).includes(L),M=(q=$.groups)==null?void 0:q.some(z=>{const T=A.get(z);return!T||!T.endDate?!1:new Date(T.endDate)>B}),F=!d.value||d.value==="active"&&M||d.value==="finished"&&!M;return J&&F})}else{const I=await fetch(`http://localhost:8000/user?${e.toString()}`);k.value=await I.json()}U.value=null}catch(s){console.error("Ошибка загрузки пользователей:",s)}},O=async()=>{try{let e;D.value?e=await fetch(`${f.app.baseURL}data/groups.json`):e=await fetch("http://localhost:8000/group"),b.value=await e.json()}catch(e){console.error("Ошибка загрузки групп:",e)}};N(()=>{O(),w()});const R=e=>{U.value=e},i=async()=>{await fetch("http://localhost:8000/user/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o.value)}),await w(),v.value=!1,o.value={surname:"",name:"",patronymic:"",email:"",login:"",password:"",phone:"",role:"user",groupIds:[]}};return(e,s)=>(u(),r("div",oe,[l("div",ae,[s[14]||(s[14]=l("h2",null,"Список пользователей",-1)),l("div",ue,[a(l("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.value=t),onChange:w,class:"filter-select"},[s[12]||(s[12]=l("option",{value:""},"Все группы",-1)),(u(!0),r(V,null,j(b.value,t=>(u(),r("option",{key:t.id,value:t.id},p(t.name),9,re))),128))],544),[[C,n.value]]),a(l("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>d.value=t),onChange:w,class:"filter-select"},s[13]||(s[13]=[l("option",{value:""},"Все статусы",-1),l("option",{value:"active"},"Активные",-1),l("option",{value:"finished"},"Завершённые",-1)]),544),[[C,d.value]])]),l("button",{class:"create-btn",onClick:s[2]||(s[2]=t=>v.value=!v.value)},p(v.value?"Отмена":"Создать пользователя"),1)]),l("div",ie,[v.value?(u(),r("div",pe,[l("form",{onSubmit:W(i,["prevent"])},[a(l("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>o.value.surname=t),placeholder:"Фамилия",required:""},null,512),[[m,o.value.surname]]),a(l("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>o.value.name=t),placeholder:"Имя",required:""},null,512),[[m,o.value.name]]),a(l("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>o.value.patronymic=t),placeholder:"Отчество"},null,512),[[m,o.value.patronymic]]),a(l("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>o.value.email=t),placeholder:"Email",required:""},null,512),[[m,o.value.email]]),a(l("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>o.value.login=t),placeholder:"Логин",required:""},null,512),[[m,o.value.login]]),a(l("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>o.value.password=t),placeholder:"Пароль",type:"password",required:""},null,512),[[m,o.value.password]]),a(l("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>o.value.phone=t),placeholder:"Телефон"},null,512),[[m,o.value.phone]]),a(l("select",{"onUpdate:modelValue":s[10]||(s[10]=t=>o.value.role=t),required:""},[(u(),r(V,null,j(S,t=>l("option",{key:t,value:t},p(t.charAt(0).toUpperCase()+t.slice(1)),9,de)),64))],512),[[C,o.value.role]]),s[15]||(s[15]=l("label",null,"Группы:",-1)),a(l("select",{"onUpdate:modelValue":s[11]||(s[11]=t=>o.value.groupIds=t),multiple:""},[(u(!0),r(V,null,j(b.value,t=>(u(),r("option",{key:t.id,value:t.id},p(t.name),9,me))),128))],512),[[C,o.value.groupIds]]),s[16]||(s[16]=l("button",{type:"submit",class:"submit-btn"},"Сохранить",-1))],32)])):(u(),r(V,{key:1},[l("ul",ve,[(u(!0),r(V,null,j(k.value,t=>(u(),r("li",{key:t.id,onClick:I=>R(t),class:Z({admin:t.role==="admin",selected:t===U.value})},[l("span",null,p(t.surname)+" "+p(t.name)+" ("+p(t.login)+")",1),t.role==="admin"?(u(),r("span",fe,"👑")):x("",!0)],10,ge))),128))]),U.value?(u(),X(ne,{key:0,user:U.value,onRefresh:w},null,8,["user"])):x("",!0)],64))])]))}},Ue=G(ye,[["__scopeId","data-v-98050ab0"]]);export{Ue as default};
