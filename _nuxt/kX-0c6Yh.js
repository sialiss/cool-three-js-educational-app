import{_ as j,F as x,c,o as a,a as n,t as h,G as d,K as R,L as I,E,M as w,r as b,h as U,y as B,s as M,N as S,O as T,P as D,Q as N,R as $}from"./BQXDO-Iu.js";const O={class:"lesson-detail pad-l"},P={class:"button-group"},z={__name:"LessonDescription",props:{lesson:Object},setup(l){const{getRole:v,toggleComplete:g}=x(),y=E(),m=w("lessons"),r=w("selectedLesson"),i=t=>{y.push(`/lesson/${t}`)},f=t=>{y.push(`/practice/${t}`)},k=async t=>{try{const e=g(t),s=m.value.find(u=>u.id===t);s&&(s.completed=!s.completed),s.completed&&(r.value=m.value.find(u=>!u.completed)||r.value)}catch(e){console.error("Ошибка при обновлении статуса урока:",e)}};return(t,e)=>(a(),c("div",O,[n("h2",null,h(l.lesson.title),1),n("p",null,h(l.lesson.description),1),n("div",P,[l.lesson.theory?(a(),c("button",{key:0,onClick:e[0]||(e[0]=s=>i(l.lesson.theory.id)),class:"primary"},"Открыть теорию")):d("",!0),l.lesson.practice?(a(),c("button",{key:1,onClick:e[1]||(e[1]=s=>f(l.lesson.practice.id)),class:"secondary"},"Открыть практику")):d("",!0),R(v)()=="user"?(a(),c("button",{key:2,onClick:e[2]||(e[2]=s=>k(l.lesson.id)),class:I(l.lesson.completed?"completed completed-active":"completed")}," ✔ "+h(l.lesson.completed?"Пройдено":"Отметить пройденным"),3)):d("",!0)])]))}},F=j(z,[["__scopeId","data-v-4f56a5c0"]]),V={class:"dashboard"},A={key:0},G={class:"progress-bar"},K={class:"progress-text"},Q={class:"lessons"},q={class:"item-list lesson-list"},H=["onClick"],J={key:0,class:"status"},W={key:1,class:"status"},X={key:2,class:"status"},Y={__name:"dashboard",setup(l){const v=B(),{getRole:g,getMe:y,isOffline:m}=x(),r=b([]),i=b(null);U(async()=>{try{let t,e;if(console.log(m.value),m.value)t=await(await fetch(`${v.app.baseURL}data/lessons.json`)).json(),e=(await(await fetch(`${v.app.baseURL}data/users.json`)).json())[0];else{const o=await fetch("http://localhost:8000/lessons/",{headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("Не удалось загрузить уроки");t=await o.json();const p=await y();if(!p.ok)throw new Error("Не удалось загрузить пользователя");e=p.user}const s=new Set(e.completedTheoryLessons.map(o=>o.id)),u=new Set(e.completedPracticeLessons.map(o=>o.id));t.forEach(o=>{var _,C;const p=(_=o.theory)==null?void 0:_.id,L=(C=o.practice)==null?void 0:C.id;o.theoryCompleted=p?s.has(p):!0,o.practiceCompleted=L?u.has(L):!0,o.completed=o.theoryCompleted&&o.practiceCompleted}),r.value=t,i.value=r.value.find(o=>!o.completed)||r.value[0]}catch(t){console.error("Ошибка загрузки данных:",t)}}),$("lessons",r),$("selectedLesson",i);const f=M(()=>{const t=r.value.filter(e=>e.completed).length;return Math.round(t/r.value.length*100)}),k=t=>{i.value=t};return(t,e)=>(a(),c("div",V,[R(g)()=="user"?(a(),c("div",A,[e[0]||(e[0]=n("h2",{class:"text-center pad-top-m"},"Прогресс обучения",-1)),n("div",G,[n("div",{class:"progress",style:S({width:f.value+"%"})},null,4)]),n("p",K,h(f.value)+"% завершено",1)])):d("",!0),e[1]||(e[1]=n("h2",{class:"text-center pad-top-m"},"Список уроков",-1)),n("div",Q,[n("ul",q,[(a(!0),c(D,null,N(r.value,s=>(a(),c("li",{key:s.id,onClick:u=>k(s),class:I({completed:s.completed,selected:s===i.value})},[n("span",null,h(s.title),1),n("div",null,[s.practice&&s.practiceCompleted?(a(),c("span",J,"🚘︎")):d("",!0),s.theory&&s.theoryCompleted?(a(),c("span",W,"🕮")):d("",!0),s.completed?(a(),c("span",X,"✓")):d("",!0)])],10,H))),128))]),i.value?(a(),T(F,{key:0,lesson:i.value},null,8,["lesson"])):d("",!0)])]))}},ee=j(Y,[["__scopeId","data-v-b9d709cf"]]);export{ee as default};
