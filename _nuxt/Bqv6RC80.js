import{_ as x,F as I,c as a,o as c,a as o,t as v,G as p,K as E,L as j,E as B,M as w,r as b,h as M,s as R,N as S,O as T,P as D,Q as N,R as $}from"./B1qYCYvZ.js";const P={class:"lesson-detail pad-l"},z={class:"button-group"},F={__name:"LessonDescription",props:{lesson:Object},setup(r){const{getRole:y,toggleComplete:k}=I(),d=B(),i=w("lessons"),m=w("selectedLesson"),_=e=>{d.push(`/lesson/${e}`)},n=e=>{d.push(`/practice/${e}`)},l=async e=>{try{const t=k(e),u=i.value.find(h=>h.id===e);u&&(u.completed=!u.completed),u.completed&&(m.value=i.value.find(h=>!h.completed)||m.value)}catch(t){console.error("Ошибка при обновлении статуса урока:",t)}};return(e,t)=>(c(),a("div",P,[o("h2",null,v(r.lesson.title),1),o("p",null,v(r.lesson.description),1),o("div",z,[r.lesson.theory?(c(),a("button",{key:0,onClick:t[0]||(t[0]=u=>_(r.lesson.theory.id)),class:"primary"},"Открыть теорию")):p("",!0),r.lesson.practice?(c(),a("button",{key:1,onClick:t[1]||(t[1]=u=>n(r.lesson.practice.id)),class:"secondary"},"Открыть практику")):p("",!0),E(y)()=="user"?(c(),a("button",{key:2,onClick:t[2]||(t[2]=u=>l(r.lesson.id)),class:j(r.lesson.completed?"completed completed-active":"completed")}," ✔ "+v(r.lesson.completed?"Пройдено":"Отметить пройденным"),3)):p("",!0)])]))}},O=x(F,[["__scopeId","data-v-4f56a5c0"]]),V={class:"dashboard"},A={key:0},G={class:"progress-bar"},K={class:"progress-text"},Q={class:"lessons"},U={class:"item-list lesson-list"},q=["onClick"],H={key:0,class:"status"},J={key:1,class:"status"},W={key:2,class:"status"},X={__name:"dashboard",setup(r){const{getRole:y,getMe:k}=I(),d=b([]),i=b(null);M(async()=>{try{const n=await fetch("http://localhost:8000/lessons/",{headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error("Не удалось загрузить уроки");const l=await n.json(),e=await k();if(!e.ok)throw new Error("Не удалось загрузить пользователя");const t=e.user,u=new Set(t.completedTheoryLessons.map(s=>s.id)),h=new Set(t.completedPracticeLessons.map(s=>s.id));l.forEach(s=>{var C,L;const f=(C=s.theory)==null?void 0:C.id,g=(L=s.practice)==null?void 0:L.id;s.theoryCompleted=f?u.has(f):!0,s.practiceCompleted=g?h.has(g):!0,s.completed=s.theoryCompleted&&s.practiceCompleted}),d.value=l,i.value=d.value.find(s=>!s.completed)||d.value[0]}catch(n){console.error("Ошибка загрузки данных:",n)}}),$("lessons",d),$("selectedLesson",i);const m=R(()=>{const n=d.value.filter(l=>l.completed).length;return Math.round(n/d.value.length*100)}),_=n=>{i.value=n};return(n,l)=>(c(),a("div",V,[E(y)()=="user"?(c(),a("div",A,[l[0]||(l[0]=o("h2",{class:"text-center pad-top-m"},"Прогресс обучения",-1)),o("div",G,[o("div",{class:"progress",style:S({width:m.value+"%"})},null,4)]),o("p",K,v(m.value)+"% завершено",1)])):p("",!0),l[1]||(l[1]=o("h2",{class:"text-center pad-top-m"},"Список уроков",-1)),o("div",Q,[o("ul",U,[(c(!0),a(D,null,N(d.value,e=>(c(),a("li",{key:e.id,onClick:t=>_(e),class:j({completed:e.completed,selected:e===i.value})},[o("span",null,v(e.title),1),o("div",null,[e.practice&&e.practiceCompleted?(c(),a("span",H,"🚘︎")):p("",!0),e.theory&&e.theoryCompleted?(c(),a("span",J,"🕮")):p("",!0),e.completed?(c(),a("span",W,"✓")):p("",!0)])],10,q))),128))]),i.value?(c(),T(O,{key:0,lesson:i.value},null,8,["lesson"])):p("",!0)])]))}},Z=x(X,[["__scopeId","data-v-69ce3923"]]);export{Z as default};
